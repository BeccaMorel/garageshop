/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package ca.mcgill.ecse.carshop.application;

import java.util.List;
import java.util.Scanner;

import ca.mcgill.ecse.carshop.model.*;
public class CarShopApplication {
    public String getGreeting() {
        return "Welcome to The Car Shop!";
    }

    public static void main(String[] args) {
        System.out.println(new CarShopApplication().getGreeting());
        
        //configure the car shop
        setup();
        
        //for prompts
        boolean running = true;
        Scanner scan = new Scanner(System.in);
        
        while(running)
        {
        	if(!isLoggedIn())
        	{
	            System.out.println("\nThe Car Shop Main Menu");
	            System.out.println("\t\t1. Login");
	            System.out.println("\t\t2. Signup");
	            System.out.println("\t\t3. Quit");
	            System.out.print("Please Enter Your Option: ");
        	}
        	else
        	{
        		System.out.println("\nWelcome, " + activeUser.getUsername());
	            System.out.println("\t\t1. View/Update Appointment");
	            System.out.println("\t\t2. Book Appointment");
	            System.out.println("\t\t3. Quit");
	            System.out.print("Please Enter Your Option: ");
        	}        	

			int choice = 0;
			try{
				choice = scan.nextInt();
			}
			catch(Exception e)
			{
				System.out.println("Invalid option..");
				continue;
			}

            switch(choice)
            {
				// Login or view/update appointment
                case 1:
                {
                	if(!isLoggedIn())
                	{
						System.out.print("Please Enter Your Username: ");
						String username = scan.next();
						
						System.out.print("Please Enter Your Password: ");
						String password = scan.next();
						
						System.out.println(CarShopApplication.login(username, password));
                	}
                	else
                	{
                		if(activeUser.getAppointments().size() == 0)
                		{
                			System.out.println("You have no appointments");
                		}
                		else
                		{
                			System.out.println(activeUser.getAppointment(0));

                			System.out.print("Update? (y/n): ");
    						if(scan.next().equals("y"))
    						{
    							System.out.print("PROMPT FOR UPDATE");
    						}
                		}
                		
                	}

                    break;
                }
				// Signup or book appointment
                case 2:
                {
                	if(!isLoggedIn())
                	{
                		System.out.print("Please Select a Username: ");
                	}
                	else
                	{
                		System.out.print("PROMPT FOR BOOKING");
                	}
					
                    break;
                }
				// Exit Application
                case 3:
                {
                    running = false;
                    scan.close();
                    activeUser = null;
                    theCarShop.delete();
                    System.out.println("Thank you for using The Car Shop!");
                    break;
                }
				// Invalid
                default:
                {
                    System.out.println("Invalid option \'" + choice + "\'");
                    break;
                }
            }
        }        
    }
    
    /***Make the basic car shop***/
    static CarShop theCarShop = new CarShop();
    static Customer activeUser = null;
    
    private static void setup()
    {
    	theCarShop.addCustomer(new Customer("user", "test", theCarShop));
    }
    
    /***Retrieve the basic car shop***/
    public static CarShop getCarshop() {
    	
		return theCarShop;
    }
    
    /***Methods for login***/
    
    public static boolean isLoggedIn() {
    	
		return (activeUser != null);
    }
    
    public static String login(String username, String pw) {
    	List<Customer> custs = theCarShop.getCustomers();
    	
    	boolean success = false;
    	for(Customer cust : custs)
	    {
	    	if(cust.getUsername().equals(username))
	    	{
	    		if(cust.getPassword().equals(pw))
	    		{
	    			success = true;
	    			activeUser = cust;
	    			break;
	    		}
	    	}
	    }
    	if(!success)
    	{
    		activeUser = null;
    		return "Username/password not found";
    	}
    	else
    	{
    		return "";
    	}
    }
}
